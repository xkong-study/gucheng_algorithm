```code
var longestSubstring = function(s, k) {
   let maxLen = 0;
    // 尝试每种不同字符数量的可能性，从1到26（假设字符串只包含小写英文字母）
    for (let uniqueTarget = 1; uniqueTarget <= 26; uniqueTarget++) {
        let map = new Map();
        let start = 0, end = 0;
        let unique = 0, countAtLeastK = 0;

        while (end < s.length) {
            if (unique <= uniqueTarget) {
                let char = s[end];
                if (!map.has(char) || map.get(char) == 0) unique++;
                map.set(char, (map.get(char) || 0) + 1);
                if (map.get(char) == k) countAtLeastK++;
                end++;
            }

            while (unique > uniqueTarget) {
                let char = s[start];
                if (map.get(char) == k) countAtLeastK--;
                map.set(char, map.get(char) - 1);
                if (map.get(char) == 0) {
                    unique--;
                    map.delete(char);
                }
                start++;
            }

            // 如果当前窗口内的所有不同字符都至少出现了K次
            if (unique == uniqueTarget && unique == countAtLeastK) {
                maxLen = Math.max(maxLen, end - start);
            }
        }
    }
    return maxLen;
}
```
