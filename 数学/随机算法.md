# Â§6 éšæœºç®—æ³•ä¸æ¦‚ç‡æ„é€ 

### âœ… ç›¸å…³é¢˜ç›®ä¸æ‰€ç”¨çŸ¥è¯†ç‚¹ï¼š

| é¢˜ç›®ç¼–å· | æ ‡é¢˜ | ä½¿ç”¨çš„æ•°å­¦æ€§è´¨ä¸ç®—æ³• |
|----------|------|----------------------|
| 398 | éšæœºæ•°ç´¢å¼• | æ°´å¡˜æŠ½æ ·ï¼ˆReservoir Samplingï¼‰|
| 382 | é“¾è¡¨éšæœºèŠ‚ç‚¹ | æ°´å¡˜æŠ½æ · |
| 384 | æ‰“ä¹±æ•°ç»„ | Fisher-Yates æ´—ç‰Œç®—æ³• |
| 470 | ç”¨ Rand7() å®ç° Rand10() | æ‹’ç»é‡‡æ ·ï¼ˆRejection Samplingï¼‰|
| 528 | æŒ‰æƒé‡éšæœºé€‰æ‹© | æ„é€ æ¦‚ç‡å‰ç¼€å’Œ + äºŒåˆ†æŸ¥æ‰¾ |
| 710 | é»‘åå•ä¸­çš„éšæœºæ•° | å“ˆå¸Œæ˜ å°„æ›¿ä»£ + æ˜ å°„æœ‰æ•ˆåŒºåŸŸ |
| 478 | åœ¨åœ†å†…éšæœºç”Ÿæˆç‚¹ | æåæ ‡é‡‡æ ·ï¼ˆâˆšr, Î¸ï¼‰|
| 497 | éé‡å çŸ©å½¢ä¸­çš„éšæœºç‚¹ | çŸ©å½¢é¢ç§¯å‰ç¼€å’Œ + äºŒåˆ†æŸ¥æ‰¾ |
| 519 | éšæœºç¿»è½¬çŸ©é˜µ | åæ ‡å‹ç¼©ä¸ºä¸€ç»´æ•°ç»„ + å“ˆå¸Œæ˜ å°„ç¿»è½¬ |
| 380 | O(1) æ’å…¥åˆ é™¤å’Œè·å–éšæœºå…ƒç´  | å“ˆå¸Œè¡¨ + æ•°ç»„ + swap æŠ€å·§ |
| 381 | O(1) æ’å…¥åˆ é™¤å’Œè·å–éšæœºå…ƒç´ ï¼ˆå¯é‡å¤ï¼‰ | å“ˆå¸Œ + ç´¢å¼•é›†åˆç®¡ç†é‡å¤å€¼ |
| 1515 | æœåŠ¡ä¸­å¿ƒçš„æœ€ä½³ä½ç½® | æ¬§å‡ é‡Œå¾—è·ç¦»å’Œæœ€å°åŒ–ï¼›æ¢¯åº¦ä¸‹é™æ³• |
| 1968 | æ„é€ ä¸ç­‰äºä¸¤ç›¸é‚»å¹³å‡å€¼çš„æ•°ç»„ | æ•°å­¦æ„é€ æŠ€å·§ + è´ªå¿ƒ |

---

### âœ… å·¥å…·å‡½æ•°æ¨¡æ¿ + ç®—æ³•å®ç°

```js
// ğŸ² 1. æ°´å¡˜æŠ½æ ·ï¼ˆä»æ•°æ®æµä¸­ç­‰æ¦‚ç‡é€‰ä¸€ä¸ªï¼‰
function reservoirSampling(stream) {
  let result = null;
  let count = 0;
  for (const x of stream) {
    count++;
    if (Math.floor(Math.random() * count) === 0) {
      result = x;
    }
  }
  return result;
}

// ğŸ° 2. æ‹’ç»é‡‡æ ·ï¼šç”¨ rand7 å®ç° rand10
function rand10() {
  while (true) {
    const num = (rand7() - 1) * 7 + rand7(); // 1 ~ 49
    if (num <= 40) return 1 + (num - 1) % 10;
  }
}

// ğŸ¯ 3. æƒé‡éšæœº + åœ†å†…é‡‡æ ·
class WeightedSampler {
  constructor(weights) {
    this.prefix = [0];
    for (let w of weights) {
      this.prefix.push(this.prefix.at(-1) + w);
    }
    this.total = this.prefix.at(-1);
  }

  pickIndex() {
    const r = Math.floor(Math.random() * this.total);
    let left = 0, right = this.prefix.length - 1;
    while (left < right) {
      const mid = (left + right) >> 1;
      if (this.prefix[mid] <= r) left = mid + 1;
      else right = mid;
    }
    return left - 1;
  }
}

function randomPointInCircle(radius, x_center, y_center) {
  const r = Math.sqrt(Math.random()) * radius;
  const theta = Math.random() * 2 * Math.PI;
  return [x_center + r * Math.cos(theta), y_center + r * Math.sin(theta)];
}

// ğŸ§® 4. é»‘åå•éšæœºæ•°
class BlacklistSampler {
  constructor(n, blacklist) {
    this.bound = n - blacklist.length;
    const set = new Set(blacklist);
    this.map = new Map();
    let last = n - 1;
    for (let b of blacklist) {
      if (b < this.bound) {
        while (set.has(last)) last--;
        this.map.set(b, last);
        last--;
      }
    }
  }
  pick() {
    const x = Math.floor(Math.random() * this.bound);
    return this.map.get(x) ?? x;
  }
}

// ğŸ² 5. æ´—ç‰Œç®—æ³• Fisher-Yates
function shuffle(nums) {
  for (let i = nums.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [nums[i], nums[j]] = [nums[j], nums[i]];
  }
  return nums;
}

// ğŸ“‰ 6. æ¢¯åº¦ä¸‹é™æ±‚å‡ ä½•ä¸­å¿ƒï¼ˆæœåŠ¡ä¸­å¿ƒï¼‰
function getMinDistSum(positions) {
  let [x, y] = [0, 0];
  for (const [px, py] of positions) {
    x += px;
    y += py;
  }
  x /= positions.length;
  y /= positions.length;

  const directions = [[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];
  let step = 1;
  let bestDist = calc(x, y);

  function calc(cx, cy) {
    return positions.reduce((sum, [px, py]) => sum + Math.hypot(cx - px, cy - py), 0);
  }

  while (step > 1e-6) {
    let improved = false;
    for (const [dx, dy] of directions) {
      const nx = x + dx * step;
      const ny = y + dy * step;
      const d = calc(nx, ny);
      if (d < bestDist) {
        x = nx; y = ny; bestDist = d;
        improved = true;
        break;
      }
    }
    if (!improved) step *= 0.5;
  }
  return bestDist;
}
```

---

