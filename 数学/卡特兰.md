## 📘 §2.3 Catalan 数 & Dyck 路径专题全知识总结

---

### ✅ 一、Catalan 数定义

Catalan 数是一类在组合数学中广泛出现的重要计数数列，常用于描述如下问题的解法数量：

- 合法括号序列
- 合法出栈序列
- 不穿越主对角线的网格路径
- Dyck 路径
- 二叉搜索树构造数
- 平衡分割问题等

**第 n 个 Catalan 数的闭式表达式为：**

\[
C_n = \frac{1}{n+1} \binom{2n}{n} = \binom{2n}{n} - \binom{2n}{n - 1}
\]

---

### ✅ 二、Dyck 路径定义

**Dyck 路径**是从 \((0, 0)\) 到 \((2n, 0)\)，由 n 步 \(+1\) 和 n 步 \(-1\) 构成的路径，要求：

- 任何前缀和 \(\geq 0\)，即路径不跌破 x 轴
- 总步数为 2n，终点回到原点
- 对应于栈的合法出入操作序列或括号合法匹配序列

**例子：** n=3 时的合法 Dyck 路径有：
- `((()))`
- `(()())`
- `(())()`
- `()(())`
- `()()()`

数量为 \( C_3 = 5 \)

---

### ✅ 三、Catalan 数的来源解析

#### 🔢 总路径数：

- 用 n 个 `+1`（上升）和 n 个 `–1`（下降）排列组合
- 不考虑合法性，路径数为：

\[
\binom{2n}{n}
\]

#### 🔍 约束条件（合法 Dyck 路径）：

- 要求前缀和不能为负 ⇒ 每一步都不跌破 x 轴

#### 📐 不合法路径的数量：反射法推导

1. 任意一条“不合法路径”，在第一次跌破 x 轴的地方，把前缀镜像
2. 得到从 \((0, 0)\) 到 \((2n, -1)\) 的路径
3. 这种路径必须有：
   - n–1 次 `+1`
   - n+1 次 `–1`

所以数量是：

\[
\binom{2n}{n - 1}
\]

---

### ✅ 四、Catalan 数的完整推导公式

\[
C_n = \binom{2n}{n} - \binom{2n}{n - 1} = \frac{1}{n + 1} \binom{2n}{n}
\]

---

### ✅ 五、相关等价模型（经典应用）

| 模型                    | 描述                                       |
|-------------------------|--------------------------------------------|
| 合法括号序列           | n 对括号，顺序合法                         |
| 栈合法出入序列         | n 个数入栈，每次只能弹出栈顶              |
| Dyck 路径               | 上下路径不跌破 x 轴                        |
| 不穿越对角线的网格路径 | 从左下到右上，不穿越 y = x                |
| 二叉搜索树构造数量     | n 个不同数字构成 BST 的个数               |
| 多边形三角划分方式     | n+2 边凸多边形可三角划分方式数量           |

---

### ✅ 六、Catalan 数的计算代码（JS）

```js
function catalan(n) {
  const MOD = 1e9 + 7;
  let fac = Array(2 * n + 1).fill(1);

  for (let i = 1; i <= 2 * n; i++) {
    fac[i] = fac[i - 1] * i % MOD;
  }

  const modInv = (a, mod) => {
    let res = 1, b = mod - 2;
    while (b) {
      if (b & 1) res = res * a % mod;
      a = a * a % mod;
      b >>= 1;
    }
    return res;
  };

  return fac[2 * n] * modInv(fac[n], MOD) % MOD * modInv(fac[n + 1], MOD) % MOD;
}
```

---

### ✅ 七、总结口诀

```
路径数目选组合，跌破反射要记得

不跌过线才合法，除以 n+1 就得
```

---

